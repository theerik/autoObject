<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>autoObject.tcl</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>autoObject.tcl</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <hr />
<p>FILENAME:    autoObject.tcl</p>
<p>AUTHOR:      theerik@github</p>
<p>DESCRIPTION:
              AutoObject is a base class used to create auto-assembling
              objects using runtime descriptors.  The key feature is that
              objects can be serialized and deserialized to/from byte
              array format, allowing them to be passed to or received
              from any interface that supports byte array/serial formats.
              Past applications include converting structured data to/from
              byte arrays for COM interfaces to other languages, message
              formats for serial communication, and parsing of memory
              blocks retrieved from embedded targets.</p>
<h6></h6>
<p>Copyright 2015-17, Erik N. Johnson</p>
<h6></h6>
<p>This package documentation is auto-generated with
Pycco: <a href="https://pycco-docs.github.io/pycco/">https://pycco-docs.github.io/pycco/</a></p>
<p>Use "pycco filename" to re-generate HTML documentation in ./docs .</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nb">package</span> require TclOO
<span class="nb">package</span> require logger

<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[namespace</span> exists <span class="o">::</span>AutoObject<span class="k">]</span> <span class="k">}</span> <span class="k">{</span>
    <span class="k">namespace</span> eval <span class="o">::</span>AutoObject <span class="k">{</span>
        <span class="k">variable</span> version <span class="mf">0.6</span>
        <span class="nv">logger</span><span class="o">::</span>init <span class="o">::</span>autoObject
        <span class="nv">logger</span><span class="o">::</span>import <span class="o">-</span>all <span class="o">-</span>namespace <span class="o">::</span>autoObject::log <span class="o">::</span>autoObject
        <span class="o">::</span><span class="nv">autoObject</span><span class="o">::</span>log::setlevel warn
    <span class="k">}</span>
<span class="nb">source</span> <span class="k">[</span><span class="nb">file</span> join <span class="k">[</span><span class="nb">file</span> dirname <span class="k">[</span><span class="nb">info</span> script<span class="k">]]</span> autoObjectWidgets.tcl<span class="k">]</span>
<span class="nb">source</span> <span class="k">[</span><span class="nb">file</span> join <span class="k">[</span><span class="nb">file</span> dirname <span class="k">[</span><span class="nb">info</span> script<span class="k">]]</span> autoObjectData.tcl<span class="k">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <hr />
<h1>autoObject base class</h1>
<p>Creates objects that use a defining list to: set up field keys that reference
  fields, create the objects populating those fields by type defined in
  the defining list, and initialize the field objects to default values.</p>
<p>The field object types must support canonical methods to determine how to
  parse or generate wire format, to programmatically set or get values,
  and to output human-readable values for logging and debug.</p>
<p>While some objects are created with only the base autoObject class, most
  uses/users will extend the base class for the particular needs of their
  application; e.g. message or data cache or COM object interface or....</p>
<p>The base class provides the following methods, which may be overridden or
extended by subclasses:</p>
<ul>
<li><em>$object</em> get ?<em>fieldName</em>? ?<em>fieldName</em> ...?</li>
<li><em>$object</em> set <em>fieldName</em> <em>value</em> ?<em>fieldName</em> <em>value</em>?</li>
<li><em>$object</em> toString</li>
<li><em>$object</em> fromList <em>byteList</em></li>
<li><em>$object</em> toList</li>
<li><em>$object</em> fromByteArray <em>binaryString</em></li>
<li><em>$object</em> toByteArray</li>
<li><em>$object</em> isInitialized</li>
<li><em>$object</em> follow</li>
<li><em>$object</em> createWidget</li>
</ul>
<p>There are two methods used for internal purposes only:</p>
<ul>
<li>SortByOffset <em>arrayName</em> <em>a</em> <em>b</em></li>
<li>IterField <em>fieldName</em> <em>args</em></li>
</ul>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nv">oo</span><span class="o">::</span>class create <span class="o">::</span>autoObject <span class="k">{</span>
    <span class="k">variable</span> BlockSize
    <span class="k">variable</span> DataArray
    <span class="k">variable</span> FieldInfo
    <span class="k">variable</span> Initialized
    <span class="k">variable</span> NameL
    <span class="k">variable</span> Variable_size</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <hr />
<h2>autoObject constructor</h2>
<p>The constructor takes as input a list defining the object to be created.
The defining list has the form of key/valueList pairs, with field names
as keys paired with a nested list of up to 6 elements, the first 3
of which are mandatory:</p>
<pre><code>{ field_offset  # Must start at 0, incr by field_size,
                # leave no gaps.
  field_size    # (Max) size of field in bytes in serial
                # input format.
  field_type    # Name of the data type. Custom types
                # must support base methods used by
                # autoObject types, may have others.
  init_value    # Value used to initialize field data.
                # May be empty {}.
  field_data    # Passed to constructor when creating the
                # object of type &lt;field_type&gt;, not used or
                # examined by autoObject.  May be empty {}.
  widget_name   # Name of an autoWidget class to use to
                # display the data in GUIs.  May be empty,
                # in which case the autoWidget "autoEntry"
                # will be used if needed.
}
</code></pre>
<p>If fewer than 6 elements are provided, the remainder will be filled
with default values as noted, usually the empty list {}.</p>
<p>There is one special reserved field name, "variable_length_object", whose
value is a single number defining the minimum size of the object.
If the value == 0, it is treated as disabling the special handling (i.e.,
the object cannot be variable-size); otherwise, too-small input is
changed to a minimum of <em>$value</em>, and fields past that size are
permitted to be variable in size.  I.e., the object will accept a
serial input of any size between <em>$value</em> and <em>blockSize</em> without
complaining, filling fields in order until it runs out of input.
If the last field is given some data but not enough bytes to fill it
correctly, it is left to the field object to complain; the containing
autoObject will not.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">constructor</span> <span class="k">{</span> <span class="nv">defineL</span> <span class="k">}</span> <span class="k">{</span>
        <span class="nv">logger</span><span class="o">::</span>import <span class="o">-</span>all <span class="o">-</span>force <span class="o">-</span>namespace log <span class="o">::</span>autoObject
<span class="err">;</span><span class="c">#log::setlevel debug</span>

        <span class="k">array</span> set definingArr <span class="nv">$defineL</span>
        <span class="k">set</span> currOffset <span class="mi">0</span>
        <span class="k">set</span> Variable_size <span class="mi">0</span>
        <span class="k">set</span> Initialized false</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>There are multiple times we'll want the list of field names sorted by
the field offset, so we do the sort once and save it for the future.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">set</span> NameL <span class="k">[</span><span class="nb">lsort</span> <span class="o">-</span>command <span class="s2">&quot;my SortByOffset definingArr&quot;</span> <span class="err">\</span>
                   <span class="k">[array</span> names definingArr<span class="k">]]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>As we read the field list to initialize the fields, parse the
sizes and offsets to validate the input.  There should be no
missing bytes in the structure.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">foreach</span> field <span class="nv">$NameL</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Take the special token "variable_length_object" out of the
NameL - we don't want to treat it like a normal field.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{</span><span class="nv">$field</span> <span class="nv">eq</span> <span class="s2">&quot;variable_length_object&quot;</span><span class="k">}</span> <span class="k">{</span>
                <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;$field: $definingArr($field)&quot;</span>
                <span class="k">set</span> Variable_size <span class="nv">$definingArr</span><span class="k">(</span><span class="nv">$field</span><span class="k">)</span>
                <span class="k">set</span> idx <span class="k">[</span><span class="nb">lsearch</span> <span class="nv">$NameL</span> <span class="s2">&quot;variable_length_object&quot;</span><span class="k">]</span>
                <span class="k">set</span> NameL <span class="k">[</span><span class="nb">lreplace</span> <span class="nv">$NameL</span> <span class="nv">$idx</span> <span class="nv">$idx</span><span class="k">]</span>
                <span class="k">continue</span>
            <span class="k">}</span>
            <span class="k">set</span> fieldList <span class="nv">$definingArr</span><span class="k">(</span><span class="nv">$field</span><span class="k">)</span>
            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;$field: $fieldList&quot;</span>
            <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">offset</span><span class="k">)</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">0</span><span class="k">]</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$currOffset</span> <span class="o">!=</span> <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">offset</span><span class="k">)}</span> <span class="k">{</span>
                <span class="k">error</span> <span class="s2">&quot;Invalid defining list: at offset\</span>
<span class="s2">                       $FieldInfo($field,offset), expected $currOffset&quot;</span>
            <span class="k">}</span>
            <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">size</span><span class="k">)</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">1</span><span class="k">]</span>
            <span class="k">set</span> currOffset <span class="k">[expr</span> <span class="k">{</span><span class="nv">$currOffset</span> <span class="o">+</span> <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">size</span><span class="k">)}]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Find the data type corresponding to the name.  Start by parsing
out any array syntax.  Then look in various namespaces to find
a definition of the type.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">set</span> tname <span class="s2">&quot;[lindex $fieldList 2]&quot;</span>
            <span class="k">set</span> isarray <span class="k">[</span><span class="nb">regexp</span> <span class="k">{(</span><span class="nv">.</span><span class="o">+</span><span class="k">)</span><span class="err">\</span><span class="k">[([</span><span class="nv">0-9</span><span class="k">]</span><span class="o">+</span><span class="k">)</span><span class="err">\</span><span class="k">]}</span> <span class="nv">$tname</span> <span class="o">-&gt;</span> basename arrcount<span class="k">]</span>
            <span class="k">if</span> <span class="nv">$isarray</span> <span class="k">{</span>
                <span class="k">set</span> tname <span class="nv">$basename</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> arrcount <span class="mi">0</span>
            <span class="k">}</span>
            <span class="k">if</span> <span class="k">{</span><span class="s2">&quot;::AutoObject::$tname&quot;</span> <span class="nv">in</span> <span class="err">\</span>
                    <span class="k">[</span><span class="nb">info</span> class instances oo::class <span class="o">::</span>AutoObject::<span class="o">*</span><span class="k">]}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Found as a type declared in the appropriate namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">set</span> tname <span class="s2">&quot;::AutoObject::$tname&quot;</span>
            <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">lsearch</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="s2">&quot;*$tname&quot;</span><span class="k">]</span> <span class="err">\</span>
                        <span class="o">!=</span> <span class="nv">-1</span><span class="k">}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Found a class defined in a different namespace; we either try
it or die in error, so we may as well keep going and try it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;class list: \</span>
<span class="s2">                            [info class instances oo::class ::AutoObject::*]&quot;</span>
                <span class="k">set</span> msg <span class="s2">&quot;No $tname in expected namespace. \</span>
<span class="s2">                            Found %s and will try it.&quot;</span>
                <span class="k">set</span> tname <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="err">\</span>
                           <span class="k">[</span><span class="nb">lsearch</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="s2">&quot;*$tname&quot;</span><span class="k">]]</span>
                <span class="nv">log</span><span class="o">::</span>info <span class="k">[</span><span class="nb">format</span> <span class="nv">$msg</span> <span class="nv">$tname</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Can't find a class with that name.  Error out.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Unknown type requested: $tname&quot;</span>
                <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;List of autoObject classes: \</span>
<span class="s2">                            [info class instances oo::class ::AutoObject::*]&quot;</span>
                <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;List of classes: [info class instances oo::class]&quot;</span>
                <span class="k">error</span> <span class="s2">&quot;Unknown type requested: $tname&quot;</span>
            <span class="k">}</span>
            <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">tname</span><span class="k">)</span> <span class="nv">$tname</span>
            <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">arrcnt</span><span class="k">)</span> <span class="nv">$arrcount</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Unpack &amp; store the rest of the defining information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$fieldList</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">3</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> initData <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">3</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> initData <span class="k">{}</span>
            <span class="k">}</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$fieldList</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">4</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> typeData <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">4</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> typeData <span class="k">{}</span>
            <span class="k">}</span>
            <span class="k">if</span> <span class="k">{([</span><span class="nb">llength</span> <span class="nv">$fieldList</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">5</span><span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="k">([</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">5</span><span class="k">]</span> <span class="nv">ne</span> <span class="k">{})}</span> <span class="k">{</span>
                <span class="k">set</span> wname <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fieldList</span> <span class="mi">5</span><span class="k">]</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$wname</span> <span class="nv">eq</span> <span class="s2">&quot;self&quot;</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">set</span> widgetName <span class="s2">&quot;self&quot;</span>
                <span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span><span class="s2">&quot;::AutoObject::$wname&quot;</span> <span class="nv">in</span> <span class="err">\</span>
                            <span class="k">[</span><span class="nb">info</span> class instances oo::class <span class="o">::</span>AutoObject::<span class="o">*</span><span class="k">]}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Found widget as a type declared in the appropriate namespace</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">set</span> widgetName <span class="s2">&quot;::AutoObject::$wname&quot;</span>
                <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">lsearch</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="s2">&quot;*$wname&quot;</span><span class="k">]</span> <span class="o">!=</span> <span class="nv">-1</span><span class="k">}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Found something not in the right namespace; we either try it
or die in error, so we may as well keep going and try it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;class list: [info class instances oo::class ::AutoObject::*]&quot;</span>
                    <span class="k">set</span> msg <span class="s2">&quot;No $wname in expected namespace.  Found %s and will try it.&quot;</span>
                    <span class="k">set</span> widgetName <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="err">\</span>
                               <span class="k">[</span><span class="nb">lsearch</span> <span class="k">[</span><span class="nb">info</span> class instances oo::class<span class="k">]</span> <span class="s2">&quot;*$wname&quot;</span><span class="k">]]</span>
                    <span class="nv">log</span><span class="o">::</span>info <span class="k">[</span><span class="nb">format</span> <span class="nv">$msg</span> <span class="nv">$widgetName</span><span class="k">]</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Unknown type requested: $wname&quot;</span>
                    <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;List of autoObject classes: [info class instances oo::class ::AutoObject::*]&quot;</span>
                    <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;List of classes: [info class instances oo::class]&quot;</span>
                    <span class="k">error</span> <span class="s2">&quot;Unknown type requested: $wname&quot;</span>
                <span class="k">}</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> widgetName <span class="o">::</span>AutoObject::autoEntry
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Create the field objects within the container object.
First check to see if field is an array of objects.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{</span><span class="nv">$isarray</span><span class="k">}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Validate that size is an integral number of bytes per entry</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">set</span> bytesPerObj <span class="k">[expr</span> <span class="k">{</span><span class="nv">int</span><span class="k">(</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">size</span><span class="k">)</span> <span class="o">/</span> <span class="nv">$arrcount</span><span class="k">)}]</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$arrcount</span> <span class="o">*</span> <span class="nv">$bytesPerObj</span> <span class="o">!=</span> <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$field</span><span class="err">,</span><span class="nv">size</span><span class="k">)}</span> <span class="k">{</span>
                    <span class="k">error</span> <span class="s2">&quot;Size not an integer multiple of array count.\n\</span>
<span class="s2">                           Array count: $arrcount, size: $FieldInfo($field,size)&quot;</span>
                <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>If we weren't given an exact list of initializer data,
assume what we were given is for one element.  Replicate
it to cover all elements.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">{([</span><span class="nb">llength</span> <span class="nv">$initData</span><span class="k">]</span> <span class="o">!=</span> <span class="nv">$arrcount</span><span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="k">(</span><span class="nv">$initData</span> <span class="nv">ne</span> <span class="k">{})}</span> <span class="k">{</span>
                    <span class="k">set</span> initData <span class="k">[</span><span class="nb">lrepeat</span> <span class="nv">$arrcount</span> <span class="nv">$initData</span><span class="k">]</span>
                <span class="k">}</span>
                <span class="k">set</span> DataArray<span class="k">(</span><span class="nv">$field</span><span class="k">)</span> <span class="k">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Create <em>arrcount</em> new objects of the specified type and
store them in a list in this field.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">for</span> <span class="k">{set</span> idx <span class="mi">0</span><span class="k">}</span> <span class="k">{</span><span class="nv">$idx</span> <span class="o">&lt;</span> <span class="nv">$arrcount</span><span class="k">}</span> <span class="k">{</span><span class="nb">incr</span> idx<span class="k">}</span> <span class="k">{</span>
                    <span class="k">if</span> <span class="k">[catch</span> <span class="k">{set</span> obj <span class="k">[</span><span class="nv">$tname</span> <span class="nv">new</span> <span class="nv">$typeData</span><span class="k">]}]</span> <span class="k">{</span>
                        <span class="k">error</span> <span class="s2">&quot;Failed to create new object of type\</span>
<span class="s2">                               $tname for field $field element $idx:\</span>
<span class="s2">                               $::errorInfo&quot;</span>
                    <span class="k">}</span>
                    <span class="k">if</span> <span class="k">{</span><span class="nv">$initData</span> <span class="nv">ne</span> <span class="k">{}}</span> <span class="k">{</span>
                        <span class="nv">$obj</span> <span class="k">set</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$initData</span> <span class="nv">$idx</span><span class="k">]</span>
                    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Mix in the GUI class for each object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="k">{</span><span class="nv">$widgetName</span> <span class="nv">ne</span> <span class="s2">&quot;self&quot;</span><span class="k">}</span> <span class="k">{</span>
                        <span class="nv">oo</span><span class="o">::</span>objdefine <span class="nv">$obj</span> <span class="k">[</span><span class="nb">list</span> mixin <span class="nv">$widgetName</span><span class="k">]</span>
                    <span class="k">}</span>
                    <span class="nb">lappend</span> DataArray<span class="k">(</span><span class="nv">$field</span><span class="k">)</span> <span class="nv">$obj</span>
                <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Forward the field name as a method name to a special
method that iterates across the list of objects in the field,
runs whatever method of the item the user wants on each one,
and collects the results in a list that is returned.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nv">oo</span><span class="o">::</span>objdefine <span class="k">[</span><span class="nv">self</span><span class="k">]</span> forward <span class="nv">$field</span> my IterField <span class="nv">$field</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Single object, not an array.  Just create &amp; init it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">[catch</span> <span class="k">{set</span> DataArray<span class="k">(</span><span class="nv">$field</span><span class="k">)</span> <span class="k">[</span><span class="nv">$tname</span> <span class="nv">new</span> <span class="nv">$typeData</span><span class="k">]}]</span> <span class="k">{</span>
                    <span class="k">error</span> <span class="s2">&quot;Failed to create new object of type\</span>
<span class="s2">                           $tname for field $field: $::errorInfo&quot;</span>
                <span class="k">}</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$initData</span> <span class="nv">ne</span> <span class="k">{}}</span> <span class="k">{</span>
                    <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$field</span><span class="k">)</span> <span class="k">set</span> <span class="nv">$initData</span>
                <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Mix in the GUI class</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">{</span><span class="nv">$widgetName</span> <span class="nv">ne</span> <span class="s2">&quot;self&quot;</span><span class="k">}</span> <span class="k">{</span>
                    <span class="nv">oo</span><span class="o">::</span>objdefine <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$field</span><span class="k">)</span> <span class="k">[</span><span class="nb">list</span> mixin <span class="nv">$widgetName</span><span class="k">]</span>
                <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Forward the field name as a method name to the object that
the field is composed of.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="nv">oo</span><span class="o">::</span>objdefine <span class="k">[</span><span class="nv">self</span><span class="k">]</span> forward <span class="nv">$field</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$field</span><span class="k">)</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Export the forwarded method so users can call it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="nv">oo</span><span class="o">::</span>objdefine <span class="k">[</span><span class="nv">self</span><span class="k">]</span> export <span class="nv">$field</span>
        <span class="k">}</span>
        <span class="k">set</span> BlockSize <span class="nv">$currOffset</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <hr />
<h4>autoObject.isInitialized</h4>
<p>Status getter.  Initialized is set false on creation, true on fromList
or fromWire.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> isInitialized <span class="k">{}</span> <span class="k">{return</span> <span class="nv">$Initialized</span><span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <hr />
<h3>autoObject.get</h3>
<p>Field getter: accepts an args list of keys, and returns a list of values
for each key provided or a single value for a single key.  If no key is
provided, returns the entire data array in a single list with
alternating keys &amp; values, as if from <em>array get</em>.
Warns on unknown keys or uninitialized object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> get <span class="k">{</span><span class="nv">args</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">set</span> outL <span class="k">{}</span>
        <span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nv">my</span> isInitialized<span class="k">]}</span> <span class="k">{</span>
            <span class="nv">log</span><span class="o">::</span>warn <span class="s2">&quot;Reading from uninitialized object [self object] of\</span>
<span class="s2">                            type [info object class [self object]]&quot;</span>
        <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>No keys: return name/value pairs for all defined fields.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="k">{</span><span class="nv">$args</span> <span class="o">==</span> <span class="k">{}}</span> <span class="k">{</span>
            <span class="k">foreach</span> key <span class="nv">$NameL</span> <span class="k">{</span>
                <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">set</span> tempL <span class="k">{}</span>
                    <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">{</span>
                        <span class="nb">lappend</span> tempL <span class="k">[</span><span class="nv">$obj</span> <span class="nv">get</span><span class="k">]</span>
                    <span class="k">}</span>
                    <span class="nb">lappend</span> outL <span class="nv">$key</span> <span class="nv">$tempL</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="nb">lappend</span> outL <span class="nv">$key</span> <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="nv">get</span><span class="k">]</span>
                <span class="k">}</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Single key: look up field, return value (if field is array, return list)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$args</span><span class="k">]</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$args</span> <span class="nv">in</span> <span class="nv">$NameL</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$args</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">set</span> tempL <span class="k">{}</span>
                    <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$args</span><span class="k">)</span> <span class="k">{</span>
                        <span class="nb">lappend</span> tempL <span class="k">[</span><span class="nv">$obj</span> <span class="nv">get</span><span class="k">]</span>
                    <span class="k">}</span>
                    <span class="k">return</span> <span class="nv">$tempL</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="k">return</span> <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$args</span><span class="k">)</span> <span class="nv">get</span><span class="k">]</span>
                <span class="k">}</span>
            <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">info</span> exists DataArray<span class="k">(</span><span class="nv">$args</span><span class="k">)]}</span> <span class="k">{</span>
                <span class="k">return</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$args</span><span class="k">)</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="nv">my</span> variable <span class="nv">$args</span>
                <span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exists <span class="nv">$args</span><span class="k">]}</span> <span class="k">{</span>
                    <span class="k">return</span> <span class="k">[set</span> <span class="nv">$args</span><span class="k">]</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Requesting non-existant field in\</span>
<span class="s2">                            [info object class [self object]] [self object]: \</span>
<span class="s2">                            \&quot;$args\&quot; not in \&quot;[array names DataArray]\&quot;&quot;</span>
                <span class="k">}</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Multiple keys: return list of values in order of keys provided.
If a field is an array, the list of values will be nested as a single
item in the output list.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="k">foreach</span> <span class="k">{</span><span class="nv">key</span><span class="k">}</span> <span class="nv">$args</span> <span class="k">{</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$key</span> <span class="nv">in</span> <span class="nv">$NameL</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                        <span class="k">set</span> tempL <span class="k">{}</span>
                        <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">{</span>
                            <span class="nb">lappend</span> tempL <span class="k">[</span><span class="nv">$obj</span> <span class="nv">get</span><span class="k">]</span>
                        <span class="k">}</span>
                        <span class="nb">lappend</span> outL <span class="nv">$tempL</span>
                    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                        <span class="nb">lappend</span> outL <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="nv">get</span><span class="k">]</span>
                    <span class="k">}</span>
                <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">info</span> exists DataArray<span class="k">(</span><span class="nv">$key</span><span class="k">)]}</span> <span class="k">{</span>
                    <span class="nb">lappend</span> outL <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Requesting non-existant field in\</span>
<span class="s2">                            [info object class [self object]] [self object]: \</span>
<span class="s2">                            \&quot;$key\&quot; not in \&quot;[array names DataArray]\&quot;&quot;</span>
                <span class="k">}</span>
            <span class="k">}</span>
        <span class="k">}</span>
        <span class="k">return</span> <span class="nv">$outL</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <hr />
<h3>autoObject.set</h3>
<p>Simple mutator: accepts a list of key/value pairs, and for each key sets
the associated value to the supplied value.
Warns on but does not reject unknown keys.  Unknown keys have values
stored in the data array and can be retrieved with <em>get</em>, but are not
involved in <em>toList</em>/<em>fromList</em> operations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> set <span class="k">{</span><span class="nv">args</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$args</span><span class="k">]</span> <span class="o">%</span><span class="nv">2</span> <span class="o">==</span> <span class="mi">1</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">error</span> <span class="s2">&quot;Odd number of arguments for set - \</span>
<span class="s2">                        set requires key/value pairs only.&quot;</span>
        <span class="k">}</span>
        <span class="k">foreach</span> <span class="k">{</span><span class="nv">key</span> val<span class="k">}</span> <span class="nv">$args</span> <span class="k">{</span>
            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;$key: $val&quot;</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$key</span> <span class="nv">eq</span> <span class="s2">&quot;Initialized&quot;</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> Initialized <span class="nv">$val</span>
                <span class="k">continue</span>
            <span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span><span class="nv">$key</span> <span class="nv">ni</span> <span class="nv">$NameL</span><span class="k">}</span> <span class="k">{</span>
                <span class="nv">log</span><span class="o">::</span>warn <span class="s2">&quot;Warning: trying to set non-standard field in \</span>
<span class="s2">                        [info object class [self object]] [self object]: \</span>
<span class="s2">                        $key &lt;- $val&quot;</span>
                <span class="k">set</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="nv">$val</span>
                <span class="k">continue</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Check for arrayed objects or single object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">arrcnt</span><span class="k">)</span> <span class="o">!=</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$Variable_size</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Fixed length array of objects</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="k">{([</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">!=</span> <span class="k">[</span><span class="nb">llength</span> <span class="nv">$val</span><span class="k">])</span> <span class="k">}</span> <span class="k">{</span>
                        <span class="k">set</span> errmsg <span class="s2">&quot;incorrect number of items to set in $key: \</span>
<span class="s2">                                    using [llength $val] arguments to set\</span>
<span class="s2">                                    [llength $DataArray($key)] objects.&quot;</span>
                        <span class="nv">log</span><span class="o">::</span>error <span class="nv">$errmsg</span>
                        <span class="k">error</span> <span class="nv">$errmsg</span>
                    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                        <span class="nv">lmap</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> item <span class="nv">$val</span> <span class="k">{</span> <span class="nv">$obj</span> <span class="k">set</span> <span class="nv">$item</span> <span class="k">}</span>
                    <span class="k">}</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Variable length array of objects - reject if the data
is too long, or so small that it's not big enough to
fill the minimum.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">set</span> inlen <span class="k">[</span><span class="nb">llength</span> <span class="nv">$val</span><span class="k">]</span>
                    <span class="k">set</span> offset <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">offset</span><span class="k">)</span>
                    <span class="k">if</span> <span class="k">{(</span><span class="nv">$Variable_size</span> <span class="o">&gt;</span> <span class="k">(</span><span class="nv">$offset</span> <span class="o">+</span> <span class="nv">$inlen</span><span class="k">))</span> <span class="o">||</span>
                            <span class="k">(</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">arrcnt</span><span class="k">)</span> <span class="o">&lt;</span> <span class="nv">$inlen</span><span class="k">)}</span> <span class="k">{</span>
                        <span class="k">set</span> errmsg <span class="s2">&quot;Incorrect number of items to set in $key: \</span>
<span class="s2">                                    using $inlen arguments to set\</span>
<span class="s2">                                    up to [llength $DataArray($key)] objects.&quot;</span>
                        <span class="nv">log</span><span class="o">::</span>error <span class="nv">$errmsg</span>
                        <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Variable_size: $Variable_size, arrcnt: $FieldInfo($key,arrcnt)&quot;</span>
                        <span class="k">error</span> <span class="nv">$errmsg</span>
                    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Set the objects to the new values.  If we have
too many objects, unset the unused ones.  If we
have too few, create new ones.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                        <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">$inlen</span><span class="k">}</span> <span class="k">{</span>
                            <span class="k">foreach</span> obj <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="nv">$inlen</span> end<span class="k">]</span> <span class="k">{</span>
                                <span class="nv">$obj</span> <span class="nv">destroy</span>
                            <span class="k">}</span>
                            <span class="k">set</span> DataArray<span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="mi">0</span> <span class="nv">$inlen-1</span><span class="k">]</span>
                        <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">&lt;</span> <span class="nv">$inlen</span><span class="k">}</span> <span class="k">{</span>
                            <span class="k">for</span> <span class="k">{set</span> i <span class="k">[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]}</span> <span class="k">{</span><span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$inlen</span><span class="k">}</span> <span class="k">{</span><span class="nb">incr</span> i<span class="k">}</span> <span class="k">{</span>
                                <span class="nb">lappend</span> DataArray<span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">[</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">tname</span><span class="k">)</span> <span class="nv">new</span> <span class="k">{}]</span>
                            <span class="k">}</span>
                        <span class="k">}</span>
                        <span class="nv">lmap</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> item <span class="nv">$val</span> <span class="k">{</span> <span class="nv">$obj</span> <span class="k">set</span> <span class="nv">$item</span> <span class="k">}</span>
                    <span class="k">}</span>
                <span class="k">}</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">set</span> <span class="nv">$val</span>
            <span class="k">}</span>
        <span class="k">}</span>
        <span class="k">set</span> Initialized true
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <hr />
<h3>autoObject.follow</h3>
<p>Returns a fully qualified path to the value of the data object;
normally used by GUIs to use a field as a textvariable.  If the data
is a list of objects, returns a list of FQPs, one per object.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> follow <span class="k">{</span><span class="nv">key</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">arrcnt</span><span class="k">)</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">return</span> <span class="k">[</span><span class="nb">info</span> object namespace <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span><span class="o">::</span>MyValue
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="k">set</span> tempL <span class="k">{}</span>
            <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">{</span>
                <span class="nb">lappend</span> tempL <span class="k">[</span><span class="nb">info</span> object namespace <span class="nv">$obj</span><span class="k">]</span><span class="o">::</span>MyValue<span class="err">]</span>
            <span class="k">}</span>
            <span class="k">return</span> <span class="nv">$tempL</span>
        <span class="k">}</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <hr />
<h3>autoObject.createWidget</h3>
<p>Returns a Tk name of a frame that encloses a grid of name/value paired
widgets.  Names are labels; values are whatever widget the value object
has mixed in that responds to the createWidget method call.
Individual field widgets have the option to add a widget to a special
list of large widgets that show up at the bottom of the grid (BigWidgetL).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> createWidget <span class="k">{</span><span class="nv">wname</span><span class="k">}</span> <span class="k">{</span>
        <span class="nv">my</span> variable MyWidget
        <span class="nv">my</span> variable BigWidgetL</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Create encapsulating frame</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">set</span> MyWidget <span class="k">[</span><span class="nv">ttk</span><span class="o">::</span>frame <span class="nv">$wname</span><span class="k">]</span>
        <span class="k">set</span> BigWidgetL <span class="k">{}</span>
        <span class="k">set</span> row <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>@@@ TODO %%% llength NameL is not really the right number for
number of rows - doesn't take into account dropped reserved
fields or arrays/bitfields that take multiple rows.  Figure
out a better count later.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$NameL</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">20</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">set</span> splitRow <span class="k">[expr</span> <span class="k">{([</span><span class="nb">llength</span> <span class="nv">$NameL</span><span class="k">]</span> <span class="o">+</span> <span class="nv">1</span><span class="k">)</span><span class="o">/</span> <span class="nv">2</span><span class="k">}]</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>Even if we think we don't need to split, split at 35 to
keep at the size of the monitor :-P</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">set</span> splitRow <span class="mi">35</span>
        <span class="k">}</span>
        <span class="k">set</span> colNum <span class="mi">1</span>
        <span class="k">foreach</span> key <span class="nv">$NameL</span> <span class="k">{</span>
            <span class="k">set</span> winName <span class="k">[</span><span class="nb">string</span> tolower <span class="nv">$key</span><span class="k">]</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)]</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                <span class="nv">grid</span> <span class="k">[</span><span class="nv">ttk</span><span class="o">::</span>label <span class="nv">$wname.l$winName</span> <span class="o">-</span>text <span class="nv">$key</span><span class="k">]</span> <span class="o">-</span>column <span class="nv">$colNum</span> <span class="err">\</span>
                        <span class="nv">-row</span> <span class="nv">$row</span> <span class="o">-</span>sticky nsew
                <span class="k">set</span> keyWidget <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="nv">createWidget</span> <span class="nv">$wname.$winName</span><span class="k">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Special support for reserved fields - if no widget
is returned, don't try to grid it or add rows.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">{</span><span class="nv">$keyWidget</span> <span class="nv">eq</span> <span class="s2">&quot;&quot;</span><span class="k">}</span> <span class="k">{</span> <span class="k">continue</span> <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>If creation returns 2 widgets, the first is for the small
in-row pace, the second is the large breakout version</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$keyWidget</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                    <span class="nb">lappend</span> BigWidgetL <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$keyWidget</span> <span class="mi">1</span><span class="k">]</span>
                    <span class="k">set</span> keyWidget <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$keyWidget</span> <span class="mi">0</span><span class="k">]</span>
                <span class="k">}</span>
                <span class="nv">grid</span> <span class="nv">$keyWidget</span> <span class="o">-</span>column <span class="k">[expr</span> <span class="nv">$colNum</span> <span class="o">+</span> <span class="mi">1</span><span class="k">]</span> <span class="o">-</span>row <span class="nv">$row</span> <span class="o">-</span>sticky nsew
                <span class="nb">incr</span> row
                <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">widget</span><span class="k">)</span> <span class="nv">$keyWidget</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="nv">grid</span> <span class="k">[</span><span class="nv">ttk</span><span class="o">::</span>label <span class="nv">$wname.l$winName</span> <span class="o">-</span>text <span class="nv">$key</span><span class="k">]</span> <span class="o">-</span>column <span class="nv">$colNum</span> <span class="err">\</span>
                        <span class="nv">-row</span> <span class="nv">$row</span> <span class="o">-</span>sticky nsew
                <span class="k">set</span> widL <span class="k">{}</span>
                <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$key</span><span class="k">)</span> <span class="k">{</span>
                    <span class="k">set</span> wnum <span class="k">[</span><span class="nb">llength</span> <span class="nv">$widL</span><span class="k">]</span>
                    <span class="k">set</span> objWidget <span class="k">[</span><span class="nv">$obj</span> <span class="nv">createWidget</span> <span class="nv">$wname.$winName$wnum</span><span class="k">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Special support for reserved fields - if no widget
is returned, don't try to grid it or add rows.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="k">{</span><span class="nv">$objWidget</span> <span class="nv">eq</span> <span class="s2">&quot;&quot;</span><span class="k">}</span> <span class="k">{</span> <span class="k">continue</span> <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>If creation returns 2 widgets, the first is for the small
in-row pace, the second is the large breakout version</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$objWidget</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                        <span class="nb">lappend</span> BigWidgetL <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$objWidget</span> <span class="mi">1</span><span class="k">]</span>
                        <span class="k">set</span> objWidget <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$objWidget</span> <span class="mi">0</span><span class="k">]</span>
                    <span class="k">}</span>

                    <span class="nb">lappend</span> widL <span class="nv">$objWidget</span>
                    <span class="nv">grid</span> <span class="nv">$objWidget</span> <span class="o">-</span>column <span class="k">[expr</span> <span class="nv">$colNum</span> <span class="o">+</span> <span class="mi">1</span><span class="k">]</span> <span class="o">-</span>row <span class="nv">$row</span> <span class="o">-</span>padx <span class="mi">4</span> <span class="o">-</span>sticky nsew
                    <span class="nb">incr</span> row
                <span class="k">}</span>
                <span class="k">set</span> FieldInfo<span class="k">(</span><span class="nv">$key</span><span class="err">,</span><span class="nv">widget</span><span class="k">)</span> <span class="nv">$widL</span>
            <span class="k">}</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$row</span> <span class="o">&gt;</span> <span class="nv">$splitRow</span><span class="k">}</span> <span class="k">{</span>
                <span class="nv">grid</span> columnconfigure <span class="nv">$wname</span> <span class="nv">$colNum</span> <span class="o">-</span>weight <span class="mi">1</span>
                <span class="nv">grid</span> columnconfigure <span class="nv">$wname</span> <span class="k">[expr</span> <span class="nv">$colNum</span> <span class="o">+</span> <span class="mi">1</span><span class="k">]</span> <span class="o">-</span>weight <span class="mi">4</span>
                <span class="k">set</span> row <span class="mi">1</span>
                <span class="nb">incr</span> colNum <span class="mi">2</span>
            <span class="k">}</span>
        <span class="k">}</span>
        <span class="nv">grid</span> columnconfigure <span class="nv">$wname</span> <span class="nv">$colNum</span> <span class="o">-</span>weight <span class="mi">1</span>
        <span class="nv">grid</span> columnconfigure <span class="nv">$wname</span> <span class="k">[expr</span> <span class="nv">$colNum</span> <span class="o">+</span> <span class="mi">1</span><span class="k">]</span> <span class="o">-</span>weight <span class="mi">4</span>
        <span class="k">set</span> row <span class="k">[expr</span> <span class="k">{</span><span class="nv">min</span><span class="k">(</span><span class="nv">$splitRow</span><span class="err">,</span> <span class="k">[</span><span class="nb">llength</span> <span class="nv">$NameL</span><span class="k">])}]</span>
        <span class="k">foreach</span> wid <span class="nv">$BigWidgetL</span> <span class="k">{</span>
            <span class="nb">incr</span> row
            <span class="nv">grid</span> <span class="nv">$wid</span> <span class="o">-</span>column <span class="mi">1</span> <span class="o">-</span>columnspan <span class="k">[expr</span> <span class="nv">$colNum</span> <span class="o">+</span> <span class="mi">1</span><span class="k">]</span> <span class="o">-</span>row <span class="nv">$row</span>
        <span class="k">}</span>
        <span class="k">return</span> <span class="nv">$MyWidget</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <hr />
<h3>autoObject.fromList <em>inputList</em></h3>
<p>Setter from byte-list format, as supplied by a decoded message or memory
dump. Accepts the byte list, parses it as defined in the associated
defining array, and stores it in the object's data array.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> fromList <span class="k">{</span><span class="nv">dataL</span><span class="k">}</span> <span class="k">{</span>
<span class="err">;</span><span class="c">#log::setlevel debug</span>
        <span class="k">set</span> dl <span class="k">[</span><span class="nb">llength</span> <span class="nv">$dataL</span><span class="k">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>Check that input is correct size for object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="k">{</span><span class="nv">$BlockSize</span> <span class="o">!=</span> <span class="k">[</span><span class="nb">llength</span> <span class="nv">$dataL</span><span class="k">]}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>In all cases, too large is an error</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{</span> <span class="nv">$dl</span> <span class="o">&gt;</span> <span class="nv">$BlockSize</span> <span class="k">}</span> <span class="k">{</span>
                <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Input for [info object class [self object]] is too\</span>
<span class="s2">                        large!  Length: $dl; should be &lt;= $BlockSize.&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>Block is too small and object is not variable-length</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span> <span class="nv">$Variable_size</span> <span class="o">==</span> <span class="nv">0</span> <span class="k">}</span> <span class="k">{</span>
                <span class="nv">log</span><span class="o">::</span>error <span class="s2">&quot;Input for [info object class [self object]] has an\</span>
<span class="s2">                        incorrect length: $dl; should be $BlockSize.&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Variable size is allowed to be smaller but not larger</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;Input for [info object class [self object]] is size\</span>
<span class="s2">                        $dl bytes (max allowed is $BlockSize, min is\</span>
<span class="s2">                        $Variable_size).&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>Special case - clear out the existing data, because we
won't loop past the end of the 0 byte input block.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">if</span> <span class="k">{</span><span class="nv">$dl</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">foreach</span> field <span class="nv">$NameL</span> <span class="k">{</span>
                        <span class="nv">my</span> set <span class="nv">$field</span> <span class="mi">0</span>
                    <span class="k">}</span>
                    <span class="k">return</span>
                <span class="k">}</span>
            <span class="k">}</span>
            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;Data is: $dataL&quot;</span>
        <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>Input is acceptable.  Process it in field order.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">foreach</span> name <span class="nv">$NameL</span> <span class="k">{</span>
            <span class="k">set</span> offset <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">offset</span><span class="k">)</span>
            <span class="k">set</span> size <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">size</span><span class="k">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>Once we're past the end of the list, stop processing.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{</span><span class="nv">$offset</span> <span class="o">&gt;=</span> <span class="nv">$dl</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">break</span>
            <span class="k">}</span>
            <span class="k">set</span> byteL <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$dataL</span> <span class="nv">$offset</span> <span class="k">[expr</span> <span class="k">{</span><span class="nv">$offset</span> <span class="o">+</span> <span class="nv">$size</span> <span class="nv">-</span> <span class="mi">1</span><span class="k">}]]</span>

            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;Getting $name value from dataL($offset -\</span>
<span class="s2">                    [expr {$offset + $size - 1}]): $byteL&quot;</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="nv">fromList</span> <span class="nv">$byteL</span>
                <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;$name set to [$DataArray($name) get]&quot;</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> bytesPerObj <span class="k">[expr</span> <span class="k">{</span><span class="nv">$size</span> <span class="o">/</span> <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">arrcnt</span><span class="k">)}]</span>
                <span class="k">set</span> offset <span class="mi">0</span>
                <span class="k">if</span> <span class="k">{</span><span class="nv">$Variable_size</span> <span class="o">!=</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
                    <span class="k">set</span> numIn <span class="k">[expr</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$byteL</span><span class="k">]</span> <span class="o">/</span> <span class="nv">$bytesPerObj</span><span class="k">}]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>If variable size, set the number of objects to match
the input data.  If we have too many objects, unset the
unused ones.  If we have too few, create new ones.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">$numIn</span><span class="k">}</span> <span class="k">{</span>
                        <span class="k">foreach</span> obj <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="nv">$numIn</span> end<span class="k">]</span> <span class="k">{</span>
                            <span class="nv">$obj</span> <span class="nv">destroy</span>
                        <span class="k">}</span>
                        <span class="k">set</span> DataArray<span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="mi">0</span> <span class="nv">$numIn-1</span><span class="k">]</span>
                    <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">&lt;</span> <span class="nv">$numIn</span><span class="k">}</span> <span class="k">{</span>
                        <span class="nb">lappend</span> DataArray<span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="k">[</span><span class="nb">lrepeat</span> <span class="k">[expr</span> <span class="k">{</span><span class="nv">$numIn</span> <span class="nv">-</span> <span class="err">\</span>
                                        <span class="k">[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]}]</span> <span class="err">\</span>
                                        <span class="k">[</span><span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">tname</span><span class="k">)</span> <span class="nv">new</span> <span class="k">{}]]</span>
                    <span class="k">}</span>
                <span class="k">}</span>
                <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="k">{</span>
                    <span class="k">set</span> start <span class="nv">$offset</span>
                    <span class="nb">incr</span> offset <span class="nv">$bytesPerObj</span>
                    <span class="k">set</span> end <span class="k">[expr</span> <span class="k">{</span><span class="nv">$offset</span> <span class="nv">-</span> <span class="mi">1</span><span class="k">}]</span>
                    <span class="k">set</span> subL <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$byteL</span> <span class="nv">$start</span> <span class="nv">$end</span><span class="k">]</span>
                    <span class="nv">$obj</span> <span class="nv">fromList</span> <span class="nv">$subL</span>
                <span class="k">}</span>
            <span class="k">}</span>
        <span class="k">}</span>
<span class="err">;</span><span class="c">#log::setlevel warn</span>
        <span class="k">set</span> Initialized true
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <hr />
<h3>autoObject.toList</h3>
<p>Getter to byte-list format, as required e.g. to send to a serial target.
Gets the byte-list representations of the field objects in the order
defined by the defining array, collects them into a combined byte list,
and returns the list.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> toList <span class="k">{}</span> <span class="k">{</span>
        <span class="k">set</span> outL <span class="k">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Iterate over the ordered list of field names created by the
constructor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">foreach</span> name <span class="nv">$NameL</span> <span class="k">{</span>
            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;Converting $name...&quot;</span>
            <span class="k">set</span> offset <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">offset</span><span class="k">)</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$outL</span><span class="k">]</span> <span class="o">!=</span> <span class="nv">$offset</span> <span class="o">&amp;&amp;</span> <span class="k">(</span><span class="nv">$Variable_size</span> <span class="o">==</span> <span class="nv">0</span>
                        <span class="o">||</span> <span class="nv">$Variable_size</span> <span class="o">&gt;</span> <span class="nv">$offset</span><span class="k">)}</span> <span class="k">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>List should have been the right size coming into each field.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="k">error</span> <span class="s2">&quot;Data list incorrect size starting at $name. \</span>
<span class="s2">                        Expected $offset bytes, got [llength $outL] ($outL).&quot;</span>
            <span class="k">}</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> dataL <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="nv">toList</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> dataL <span class="k">{}</span>
                <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="k">{</span>
                    <span class="nb">lappend</span> dataL <span class="k">{</span><span class="o">*</span><span class="k">}[</span><span class="nv">$obj</span> <span class="nv">toList</span><span class="k">]</span>
                <span class="k">}</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>Field object should generate correct list length.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">set</span> size <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">size</span><span class="k">)</span>
            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$dataL</span><span class="k">]</span> <span class="o">!=</span> <span class="nv">$size</span> <span class="o">&amp;&amp;</span> <span class="k">(</span><span class="nv">$Variable_size</span> <span class="o">==</span> <span class="nv">0</span>
                        <span class="o">||</span> <span class="nv">$Variable_size</span> <span class="o">&gt;</span> <span class="k">(</span><span class="nv">$offset</span> <span class="o">+</span> <span class="nv">$size</span><span class="k">))}</span> <span class="k">{</span>
                <span class="k">set</span> errMsg <span class="s2">&quot;Data object $name generated wrong size list. \</span>
<span class="s2">                       Expected $size bytes, got [llength $dataL] ($dataL).&quot;</span>
                <span class="k">error</span> <span class="nv">$errMsg</span>
            <span class="k">}</span>
            <span class="nb">lappend</span> outL <span class="k">{</span><span class="o">*</span><span class="k">}</span><span class="nv">$dataL</span>
            <span class="k">unset</span> dataL
        <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>Convert to list of non-negative byte values (range 0-255)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">set</span> retL <span class="k">{}</span>
        <span class="k">foreach</span> b <span class="nv">$outL</span> <span class="k">{</span>
            <span class="nb">lappend</span> retL <span class="k">[expr</span> <span class="k">{</span><span class="nv">$b</span> <span class="o">&amp;</span> <span class="nv">0xff</span><span class="k">}]</span>
        <span class="k">}</span>
        <span class="k">return</span> <span class="nv">$retL</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <hr />
<h3>autoObject.toString</h3>
<p>Getter to screen format.  For each field, retrieves the value and appends
it to the output string in the style defined by the type in the field
array.  Displays fields not defined in the defining array at the end,
marked as special.</p>
<p>This can be overridden by derived classes to create a different default
format, but has a nominal implementation in place:  name: value, where
the colon is 36 columns from the left margin.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> toString <span class="k">{</span> <span class="k">{</span><span class="nv">keysL</span> <span class="k">{}}</span> <span class="k">}</span> <span class="k">{</span>
        <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;&quot;</span>
        <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;    [ info object class [self object] ] [self object]:&quot;</span>
        <span class="k">set</span> outL <span class="k">{}</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$keysL</span><span class="k">]</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">set</span> keysL <span class="nv">$NameL</span>
        <span class="k">}</span>
<span class="err">;</span><span class="c">#log::setlevel debug</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>Iterate over the ordered list of field names created by the
constructor.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">foreach</span> name <span class="nv">$keysL</span> <span class="k">{</span>
            <span class="k">set</span> size <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">size</span><span class="k">)</span>
            <span class="k">set</span> offset <span class="nv">$FieldInfo</span><span class="k">(</span><span class="nv">$name</span><span class="err">,</span><span class="nv">offset</span><span class="k">)</span>
            <span class="nv">log</span><span class="o">::</span>debug <span class="s2">&quot;$name: $size bytes @ $offset bytes&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>Set field value string with string from field objects</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">&gt;</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> outStr <span class="s2">&quot;&quot;</span>
                <span class="k">set</span> cnt <span class="o">-</span><span class="mi">1</span>
                <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="k">{</span>
                    <span class="k">if</span> <span class="k">{[</span><span class="nb">incr</span> cnt<span class="k">]</span> <span class="o">==</span> <span class="nv">8</span><span class="k">}</span> <span class="k">{</span>
                        <span class="nb">append</span> outStr <span class="s2">&quot;\n&quot;</span>
                        <span class="nb">append</span> outStr <span class="k">[</span><span class="nb">string</span> repeat <span class="s2">&quot; &quot;</span> <span class="mi">44</span><span class="k">]</span>
                        <span class="k">set</span> cnt <span class="mi">0</span>
                    <span class="k">}</span>
                    <span class="nb">append</span> outStr <span class="s2">&quot;[$obj toString] &quot;</span>
                <span class="k">}</span>
                <span class="k">set</span> outStr <span class="k">[</span><span class="nb">string</span> trimright <span class="nv">$outStr</span> <span class="s2">&quot; &quot;</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)]</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span>  <span class="k">{</span>
                <span class="k">set</span> outstr <span class="s2">&quot;No Data&quot;</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="k">set</span> outStr <span class="k">[</span><span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$name</span><span class="k">)</span> <span class="nv">toString</span><span class="k">]</span>
            <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>Append field name &amp; value strings to output string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="nb">lappend</span> outL <span class="k">[</span><span class="nb">format</span> <span class="s2">&quot;       %35s: %s&quot;</span> <span class="nv">$name</span> <span class="nv">$outStr</span><span class="k">]</span>
        <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>Be sure to document any extra fields in the data dict</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">foreach</span> <span class="k">{</span><span class="nv">name</span> value<span class="k">}</span> <span class="k">[array</span> get DataArray<span class="k">]</span> <span class="k">{</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$name</span> <span class="nv">ni</span> <span class="nv">$NameL</span><span class="k">}</span> <span class="k">{</span>
                <span class="nb">lappend</span> lines <span class="k">[</span><span class="nb">format</span> <span class="s2">&quot;       %35s: %s&quot;</span> <span class="nv">$name</span> <span class="nv">$value</span><span class="k">]</span>
            <span class="k">}</span>
        <span class="k">}</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exists lines<span class="k">]}</span> <span class="k">{</span>
            <span class="nb">lappend</span> outL <span class="s2">&quot;&quot;</span>
            <span class="nb">lappend</span> outL <span class="s2">&quot;Extra fields in datablock:&quot;</span>
            <span class="k">foreach</span> line <span class="nv">$lines</span> <span class="k">{</span>
                <span class="nb">lappend</span> outL <span class="nv">$line</span>
            <span class="k">}</span>
            <span class="k">unset</span> lines
        <span class="k">}</span>
        <span class="k">return</span> <span class="k">[</span><span class="nb">join</span> <span class="nv">$outL</span> <span class="s2">&quot;\n&quot;</span><span class="k">]</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <hr />
<h4>autoObject.fromByteArray</h4>
<p>From e.g. wire format or COM interface.  Converts from binary string to
list format, then calls fromList.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> fromByteArray <span class="k">{</span><span class="nv">byteArray</span><span class="k">}</span> <span class="k">{</span>
        <span class="nb">binary</span> scan <span class="nv">$byteArray</span> <span class="s2">&quot;cu*&quot;</span> byteList
        <span class="nv">my</span> fromList <span class="nv">$byteList</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <hr />
<h4>autoObject.toByteArray</h4>
<p>To e.g. wire format or COM interface.  Calls toList, then converts from
list format to binary string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> toByteArray <span class="k">{}</span> <span class="k">{</span>
        <span class="k">set</span> byteList <span class="k">[</span><span class="nv">my</span> toList<span class="k">]</span>
        <span class="k">set</span> byteArray <span class="k">[</span><span class="nb">binary</span> format <span class="s2">&quot;c*&quot;</span> <span class="nv">$byteList</span><span class="k">]</span>
        <span class="k">return</span> <span class="nv">$byteArray</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <hr />
<h4>autoObject.SortByOffset</h4>
<p>helper proc used to sort name list by field offset</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> SortByOffset <span class="k">{</span><span class="nv">arrayname</span> a b<span class="k">}</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{</span><span class="nv">$a</span> <span class="nv">eq</span> <span class="s2">&quot;variable_length_object&quot;</span><span class="k">}</span> <span class="k">{return</span> <span class="o">-</span><span class="mi">1</span><span class="k">}</span>
        <span class="k">if</span> <span class="k">{</span><span class="nv">$b</span> <span class="nv">eq</span> <span class="s2">&quot;variable_length_object&quot;</span><span class="k">}</span> <span class="k">{return</span> <span class="mi">1</span><span class="k">}</span>
        <span class="k">upvar</span> <span class="nv">$arrayname</span> array
        <span class="k">if</span> <span class="k">{[</span><span class="nb">lindex</span> <span class="nv">$array</span><span class="k">(</span><span class="nv">$a</span><span class="k">)</span> <span class="mi">0</span><span class="k">]</span> <span class="o">==</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$array</span><span class="k">(</span><span class="nv">$b</span><span class="k">)</span> <span class="mi">0</span><span class="k">]}</span> <span class="k">{</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">}</span> <span class="k">elseif</span> <span class="k">{[</span><span class="nb">lindex</span> <span class="nv">$array</span><span class="k">(</span><span class="nv">$a</span><span class="k">)</span> <span class="mi">0</span><span class="k">]</span> <span class="o">&lt;</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$array</span><span class="k">(</span><span class="nv">$b</span><span class="k">)</span> <span class="mi">0</span><span class="k">]}</span> <span class="k">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">}</span>
    <span class="k">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <hr />
<h4>autoObject.IterField</h4>
<p>helper proc used to forward commands to an autoData field if the field
is a list/array of objects.  Iterates across all the objects in the
list of that field, runs the desired command on each one, collects the
return values in a list, and returns that list.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nv">method</span> IterField <span class="k">{</span><span class="nv">fieldName</span> args<span class="k">}</span> <span class="k">{</span>
        <span class="k">foreach</span> obj <span class="nv">$DataArray</span><span class="k">(</span><span class="nv">$fieldName</span><span class="k">)</span> <span class="k">{</span>
            <span class="nb">lappend</span> outL <span class="k">[</span><span class="nv">$obj</span> <span class="k">{</span><span class="o">*</span><span class="k">}</span><span class="nv">$args</span><span class="k">]</span>
        <span class="k">}</span>
        <span class="k">return</span> <span class="nv">$outL</span>
    <span class="k">}</span>
<span class="k">}</span>

<span class="k">}</span>
<span class="nb">package</span> provide autoObject <span class="nv">$::AutoObject::version</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
